{
  "version": 3,
  "sources": ["../../../../../../Users/alexcapsunel/Documents/GitHub/capsuna_work/netlify/functions/journals.js", "../../../../../../Users/alexcapsunel/Documents/GitHub/capsuna_work/netlify/functions/utils/db.js", "../../../../../../Users/alexcapsunel/Documents/GitHub/capsuna_work/netlify/functions/models/Journal.js"],
  "sourceRoot": "/var/folders/d6/2tbmdwln2p15fyp3qmqj0dt80000gn/T/tmp-18744-1SZAxnxB8VMi",
  "sourcesContent": ["import connectToDatabase from './utils/db.js';\nimport Journal from './models/Journal.js';\n\nexport const handler = async (event, context) => {\n  // Make the database connection available for reuse\n  context.callbackWaitsForEmptyEventLoop = false;\n  \n  console.log(`Journals API: ${event.httpMethod} ${event.path}`);\n  \n  try {\n    // Connect to database\n    const db = await connectToDatabase();\n    console.log('Database connection established');\n    \n    // Handle different HTTP methods\n    switch (event.httpMethod) {\n      case 'GET':\n        // Check if this is a search request\n        if (event.path.includes('/search')) {\n          const params = new URLSearchParams(event.queryStringParameters);\n          const query = params.get('q');\n          \n          console.log(`Searching journals with query: ${query}`);\n          \n          if (!query) {\n            return {\n              statusCode: 400,\n              body: JSON.stringify({ message: 'Search query is required' })\n            };\n          }\n          \n          // Use text search or regex if the query is too short for text search\n          let journals;\n          if (query.length < 3) {\n            // Use regex for short queries as text search requires at least 3 characters\n            journals = await Journal.find({\n              $or: [\n                { title: { $regex: query, $options: 'i' } },\n                { content: { $regex: query, $options: 'i' } },\n                { tags: { $in: [new RegExp(query, 'i')] } }\n              ]\n            });\n          } else {\n            // Use text search for longer queries\n            journals = await Journal.find(\n              { $text: { $search: query } },\n              { score: { $meta: \"textScore\" } }\n            ).sort({ score: { $meta: \"textScore\" } });\n          }\n          \n          console.log(`Found ${journals.length} journals matching the query`);\n          return {\n            statusCode: 200,\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(journals)\n          };\n        } else if (event.path === '/.netlify/functions/journals') {\n          // Get all journals\n          console.log('Getting all journals');\n          const journals = await Journal.find();\n          console.log(`Found ${journals.length} journals`);\n          return {\n            statusCode: 200,\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(journals)\n          };\n        } else {\n          // Get single journal by ID (from path parameter)\n          const id = event.path.split('/').pop();\n          console.log(`Getting journal with ID: ${id}`);\n          const journal = await Journal.findOne({ id });\n          \n          if (!journal) {\n            console.log(`Journal not found with ID: ${id}`);\n            return {\n              statusCode: 404,\n              body: JSON.stringify({ message: 'Journal not found' })\n            };\n          }\n          \n          console.log('Journal found:', journal.title);\n          return {\n            statusCode: 200,\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(journal)\n          };\n        }\n      \n      case 'POST':\n        // Create a new journal\n        const journalData = JSON.parse(event.body);\n        console.log('Creating new journal:', JSON.stringify(journalData));\n        \n        const newJournal = new Journal(journalData);\n        console.log('Journal model created, saving to database...');\n        \n        const savedJournal = await newJournal.save();\n        console.log('Journal saved to database with ID:', savedJournal.id);\n        \n        return {\n          statusCode: 201,\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(savedJournal)\n        };\n      \n      case 'PUT':\n        // Update a journal\n        const updateId = event.path.split('/').pop();\n        const updateData = JSON.parse(event.body);\n        console.log(`Updating journal ${updateId}:`, JSON.stringify(updateData));\n        \n        const updatedJournal = await Journal.findOneAndUpdate(\n          { id: updateId },\n          updateData,\n          { new: true }\n        );\n        \n        if (!updatedJournal) {\n          console.log(`Journal not found for update with ID: ${updateId}`);\n          return {\n            statusCode: 404,\n            body: JSON.stringify({ message: 'Journal not found' })\n          };\n        }\n        \n        console.log('Journal updated:', updatedJournal.title);\n        return {\n          statusCode: 200,\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(updatedJournal)\n        };\n      \n      case 'DELETE':\n        // Delete a journal\n        const deleteId = event.path.split('/').pop();\n        console.log(`Deleting journal with ID: ${deleteId}`);\n        \n        const deletedJournal = await Journal.findOneAndDelete({ id: deleteId });\n        \n        if (!deletedJournal) {\n          console.log(`Journal not found for deletion with ID: ${deleteId}`);\n          return {\n            statusCode: 404,\n            body: JSON.stringify({ message: 'Journal not found' })\n          };\n        }\n        \n        console.log('Journal deleted successfully');\n        return {\n          statusCode: 200,\n          body: JSON.stringify({ message: 'Journal deleted' })\n        };\n      \n      default:\n        // Method not allowed\n        console.log(`Method not allowed: ${event.httpMethod}`);\n        return {\n          statusCode: 405,\n          body: JSON.stringify({ message: 'Method not allowed' })\n        };\n    }\n  } catch (error) {\n    console.error('Error in journals function:', error);\n    return {\n      statusCode: 500,\n      body: JSON.stringify({ \n        message: 'Server error', \n        error: error.message,\n        stack: error.stack \n      })\n    };\n  }\n}; ", "import mongoose from 'mongoose';\n\nlet cachedDb = null;\n\nasync function connectToDatabase() {\n  if (cachedDb) {\n    return cachedDb;\n  }\n\n  // Get MongoDB URI from environment\n  const mongoUri = process.env.REACT_APP_MONGODB_URI;\n  \n  // Validate URI exists\n  if (!mongoUri) {\n    const error = new Error(\n      'REACT_APP_MONGODB_URI environment variable is not set. ' +\n      'Please configure it in your Netlify dashboard under Site settings > Environment variables.'\n    );\n    console.error(error.message);\n    throw error;\n  }\n\n  // Connection options\n  const options = {\n    dbName: 'capsuna_work' // Explicitly set the database name\n  };\n\n  try {\n    console.log('Connecting to MongoDB...');\n    console.log('MongoDB URI:', mongoUri.replace(/\\/\\/([^:]+):([^@]+)@/, '//$1:****@')); // Log without password\n    \n    const conn = await mongoose.connect(mongoUri, options);\n    cachedDb = conn;\n    console.log('MongoDB connected successfully to database:', conn.connection.db.databaseName);\n    return cachedDb;\n  } catch (error) {\n    console.error('MongoDB connection error:', error);\n    throw error;\n  }\n}\n\nexport default connectToDatabase; ", "import mongoose from 'mongoose';\n\nconst JournalSchema = new mongoose.Schema({\n  id: {\n    type: String,\n    required: true,\n    unique: true\n  },\n  title: {\n    type: String,\n    required: true\n  },\n  content: {\n    type: String,\n    default: ''\n  },\n  date: {\n    type: Date,\n    required: true,\n    default: Date.now\n  },\n  createdAt: {\n    type: Date,\n    default: Date.now\n  },\n  updatedAt: {\n    type: Date,\n    default: Date.now\n  },\n  tags: [{\n    type: String\n  }]\n}, {\n  collection: 'journals',\n  timestamps: true  // This will automatically update the updatedAt field\n});\n\n// Create a text index for searching\nJournalSchema.index({\n  title: 'text',\n  content: 'text',\n  tags: 'text'\n});\n\n// Use existing model if it exists, otherwise create a new one\nconst Journal = mongoose.models.Journal || mongoose.model('Journal', JournalSchema);\n\nexport default Journal; "],
  "mappings": "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",
  "names": ["mongoose", "import_mongoose", "mongoose"]
}
