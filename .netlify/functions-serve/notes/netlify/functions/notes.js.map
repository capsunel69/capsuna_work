{
  "version": 3,
  "sources": ["../../../../../../Users/alexcapsunel/Documents/GitHub/capsuna_work/netlify/functions/utils/db.js", "../../../../../../Users/alexcapsunel/Documents/GitHub/capsuna_work/netlify/functions/models/Note.js", "../../../../../../Users/alexcapsunel/Documents/GitHub/capsuna_work/netlify/functions/notes.js"],
  "sourceRoot": "/var/folders/d6/2tbmdwln2p15fyp3qmqj0dt80000gn/T/tmp-18744-6I3puuffvsLl",
  "sourcesContent": ["import mongoose from 'mongoose';\n\nlet cachedDb = null;\n\nasync function connectToDatabase() {\n  if (cachedDb) {\n    return cachedDb;\n  }\n\n  // Get MongoDB URI from environment\n  const mongoUri = process.env.REACT_APP_MONGODB_URI;\n  \n  // Validate URI exists\n  if (!mongoUri) {\n    const error = new Error(\n      'REACT_APP_MONGODB_URI environment variable is not set. ' +\n      'Please configure it in your Netlify dashboard under Site settings > Environment variables.'\n    );\n    console.error(error.message);\n    throw error;\n  }\n\n  // Connection options\n  const options = {\n    dbName: 'capsuna_work' // Explicitly set the database name\n  };\n\n  try {\n    console.log('Connecting to MongoDB...');\n    console.log('MongoDB URI:', mongoUri.replace(/\\/\\/([^:]+):([^@]+)@/, '//$1:****@')); // Log without password\n    \n    const conn = await mongoose.connect(mongoUri, options);\n    cachedDb = conn;\n    console.log('MongoDB connected successfully to database:', conn.connection.db.databaseName);\n    return cachedDb;\n  } catch (error) {\n    console.error('MongoDB connection error:', error);\n    throw error;\n  }\n}\n\nexport default connectToDatabase; ", "import mongoose from 'mongoose';\n\nconst NoteSchema = new mongoose.Schema({\n  id: {\n    type: String,\n    required: true,\n    unique: true\n  },\n  content: {\n    type: String,\n    default: ''\n  },\n  updatedAt: {\n    type: Date,\n    default: Date.now\n  }\n}, {\n  collection: 'notes',\n  timestamps: true\n});\n\n// Use existing model if it exists, otherwise create a new one\nconst Note = mongoose.models.Note || mongoose.model('Note', NoteSchema);\n\nexport default Note; ", "import connectToDatabase from './utils/db.js';\nimport Note from './models/Note.js';\n\nexports.handler = async (event, context) => {\n  // Make the database connection available for reuse\n  context.callbackWaitsForEmptyEventLoop = false;\n  \n  console.log(`Notes API: ${event.httpMethod} ${event.path}`);\n  \n  try {\n    // Connect to database\n    const db = await connectToDatabase();\n    console.log('Database connection established');\n    \n    // Handle different HTTP methods\n    switch (event.httpMethod) {\n      case 'GET':\n        // Get the first note (we only need one)\n        console.log('Getting the sticky note');\n        const note = await Note.findOne();\n        console.log('Note found:', note);\n        return {\n          statusCode: 200,\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(note || { content: '' })\n        };\n      \n      case 'POST':\n        // Create or update the note\n        const noteData = JSON.parse(event.body);\n        console.log('Creating/updating note:', JSON.stringify(noteData));\n        \n        // Try to find existing note first\n        let existingNote = await Note.findOne();\n        \n        if (existingNote) {\n          // Update existing note\n          existingNote.content = noteData.content;\n          existingNote.updatedAt = new Date();\n          const updatedNote = await existingNote.save();\n          console.log('Note updated');\n          return {\n            statusCode: 200,\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(updatedNote)\n          };\n        } else {\n          // Create new note\n          const newNote = new Note(noteData);\n          const savedNote = await newNote.save();\n          console.log('New note created');\n          return {\n            statusCode: 201,\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(savedNote)\n          };\n        }\n      \n      default:\n        // Method not allowed\n        console.log(`Method not allowed: ${event.httpMethod}`);\n        return {\n          statusCode: 405,\n          body: JSON.stringify({ message: 'Method not allowed' })\n        };\n    }\n  } catch (error) {\n    console.error('Error:', error);\n    return {\n      statusCode: 500,\n      body: JSON.stringify({ message: 'Internal server error', error: error.message })\n    };\n  }\n}; "],
  "mappings": "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",
  "names": ["mongoose", "import_mongoose", "mongoose"]
}
