{
  "version": 3,
  "sources": ["../../../../../../Users/alexcapsunel/Documents/GitHub/capsuna_work/netlify/functions/reminders.js", "../../../../../../Users/alexcapsunel/Documents/GitHub/capsuna_work/netlify/functions/utils/db.js", "../../../../../../Users/alexcapsunel/Documents/GitHub/capsuna_work/netlify/functions/models/Reminder.js"],
  "sourceRoot": "/var/folders/d6/2tbmdwln2p15fyp3qmqj0dt80000gn/T/tmp-18744-lY9vVOSPYAP1",
  "sourcesContent": ["import connectToDatabase from './utils/db.js';\nimport Reminder from './models/Reminder.js';\n\nexport const handler = async (event, context) => {\n  // Make the database connection available for reuse\n  context.callbackWaitsForEmptyEventLoop = false;\n  \n  console.log(`Reminders API: ${event.httpMethod} ${event.path}`);\n  \n  try {\n    // Connect to database\n    const db = await connectToDatabase();\n    console.log('Database connection established');\n    \n    // Handle different HTTP methods\n    switch (event.httpMethod) {\n      case 'GET':\n        if (event.path === '/.netlify/functions/reminders') {\n          // Get all reminders\n          console.log('Getting all reminders');\n          const reminders = await Reminder.find();\n          console.log(`Found ${reminders.length} reminders`);\n          return {\n            statusCode: 200,\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(reminders)\n          };\n        } else {\n          // Get single reminder by ID (from path parameter)\n          const id = event.path.split('/').pop();\n          console.log(`Getting reminder with ID: ${id}`);\n          const reminder = await Reminder.findOne({ id });\n          \n          if (!reminder) {\n            console.log(`Reminder not found with ID: ${id}`);\n            return {\n              statusCode: 404,\n              body: JSON.stringify({ message: 'Reminder not found' })\n            };\n          }\n          \n          console.log('Reminder found:', reminder.title);\n          return {\n            statusCode: 200,\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(reminder)\n          };\n        }\n      \n      case 'POST':\n        // Create a new reminder\n        const reminderData = JSON.parse(event.body);\n        console.log('Creating new reminder:', JSON.stringify(reminderData));\n        \n        const newReminder = new Reminder(reminderData);\n        console.log('Reminder model created, saving to database...');\n        \n        const savedReminder = await newReminder.save();\n        console.log('Reminder saved to database with ID:', savedReminder.id);\n        \n        return {\n          statusCode: 201,\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(savedReminder)\n        };\n      \n      case 'PUT':\n        // Update a reminder\n        const updateId = event.path.split('/').pop();\n        const updateData = JSON.parse(event.body);\n        console.log(`Updating reminder ${updateId}:`, JSON.stringify(updateData));\n        \n        const updatedReminder = await Reminder.findOneAndUpdate(\n          { id: updateId },\n          updateData,\n          { new: true }\n        );\n        \n        if (!updatedReminder) {\n          console.log(`Reminder not found for update with ID: ${updateId}`);\n          return {\n            statusCode: 404,\n            body: JSON.stringify({ message: 'Reminder not found' })\n          };\n        }\n        \n        console.log('Reminder updated:', updatedReminder.title);\n        return {\n          statusCode: 200,\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(updatedReminder)\n        };\n      \n      case 'DELETE':\n        // Delete a reminder\n        const deleteId = event.path.split('/').pop();\n        console.log(`Deleting reminder with ID: ${deleteId}`);\n        \n        const deletedReminder = await Reminder.findOneAndDelete({ id: deleteId });\n        \n        if (!deletedReminder) {\n          console.log(`Reminder not found for deletion with ID: ${deleteId}`);\n          return {\n            statusCode: 404,\n            body: JSON.stringify({ message: 'Reminder not found' })\n          };\n        }\n        \n        console.log('Reminder deleted successfully');\n        return {\n          statusCode: 200,\n          body: JSON.stringify({ message: 'Reminder deleted' })\n        };\n      \n      default:\n        // Method not allowed\n        console.log(`Method not allowed: ${event.httpMethod}`);\n        return {\n          statusCode: 405,\n          body: JSON.stringify({ message: 'Method not allowed' })\n        };\n    }\n  } catch (error) {\n    console.error('Error in reminders function:', error);\n    return {\n      statusCode: 500,\n      body: JSON.stringify({ \n        message: 'Server error', \n        error: error.message,\n        stack: error.stack \n      })\n    };\n  }\n}; ", "import mongoose from 'mongoose';\n\nlet cachedDb = null;\n\nasync function connectToDatabase() {\n  if (cachedDb) {\n    return cachedDb;\n  }\n\n  // Debug: Log all env vars starting with REACT_APP or MONGODB (without values for security)\n  console.log('Available env vars:', Object.keys(process.env).filter(k => \n    k.includes('MONGO') || k.includes('REACT_APP')\n  ));\n  \n  // Get MongoDB URI from environment\n  const mongoUri = process.env.REACT_APP_MONGODB_URI;\n  \n  // Debug logging\n  console.log('REACT_APP_MONGODB_URI exists:', !!mongoUri);\n  console.log('REACT_APP_MONGODB_URI type:', typeof mongoUri);\n  console.log('REACT_APP_MONGODB_URI length:', mongoUri ? mongoUri.length : 0);\n  \n  // Validate URI exists and is a non-empty string\n  if (!mongoUri || typeof mongoUri !== 'string' || mongoUri.trim() === '') {\n    const error = new Error(\n      'REACT_APP_MONGODB_URI environment variable is not set or is empty. ' +\n      'Please configure it in your Netlify dashboard under Site settings > Environment variables. ' +\n      `Current value type: ${typeof mongoUri}, truthy: ${!!mongoUri}`\n    );\n    console.error(error.message);\n    throw error;\n  }\n\n  // Validate URI format\n  if (!mongoUri.startsWith('mongodb://') && !mongoUri.startsWith('mongodb+srv://')) {\n    const error = new Error(\n      `Invalid MongoDB URI format. URI must start with 'mongodb://' or 'mongodb+srv://'. ` +\n      `Got: ${mongoUri.substring(0, 20)}...`\n    );\n    console.error(error.message);\n    throw error;\n  }\n\n  // Connection options\n  const options = {\n    dbName: 'capsuna_work' // Explicitly set the database name\n  };\n\n  try {\n    console.log('Connecting to MongoDB...');\n    console.log('MongoDB URI (masked):', mongoUri.replace(/\\/\\/([^:]+):([^@]+)@/, '//$1:****@'));\n    \n    const conn = await mongoose.connect(mongoUri, options);\n    cachedDb = conn;\n    console.log('MongoDB connected successfully to database:', conn.connection.db.databaseName);\n    return cachedDb;\n  } catch (error) {\n    console.error('MongoDB connection error:', error.message);\n    throw error;\n  }\n}\n\nexport default connectToDatabase; ", "import mongoose from 'mongoose';\n\nconst RecurringConfigSchema = new mongoose.Schema({\n  type: {\n    type: String,\n    enum: ['weekly', 'monthly'],\n    required: true\n  },\n  subtype: {\n    type: String,\n    enum: ['dayOfMonth', 'relativeDay'],\n  },\n  dayOfWeek: {\n    type: Number,\n    min: 0,\n    max: 6\n  },\n  dayOfMonth: {\n    type: Number,\n    min: 1,\n    max: 31\n  },\n  weekNum: {\n    type: Number,\n    enum: [1, 2, 3, 4, -1]  // First, Second, Third, Fourth, Last\n  },\n  time: {\n    type: String\n  }\n});\n\nconst ReminderSchema = new mongoose.Schema({\n  id: {\n    type: String,\n    required: true,\n    unique: true\n  },\n  title: {\n    type: String,\n    required: true\n  },\n  description: {\n    type: String,\n    default: ''\n  },\n  date: {\n    type: Date,\n    required: true\n  },\n  completed: {\n    type: Boolean,\n    default: false\n  },\n  recurring: {\n    type: String,\n    enum: ['', 'daily', 'weekly', 'monthly'],\n    default: ''\n  },\n  recurringConfig: {\n    type: RecurringConfigSchema\n  },\n  convertedToTask: {\n    type: Boolean,\n    default: false\n  },\n  convertedToTaskDates: {\n    type: [String],\n    default: []\n  },\n  completedInstances: {\n    type: [Date],\n    default: []\n  }\n}, {\n  collection: 'reminders', // Explicitly set collection name\n  timestamps: true // Adds createdAt and updatedAt timestamps\n});\n\n// Use existing model if it exists, otherwise create a new one\nconst Reminder = mongoose.models.Reminder || mongoose.model('Reminder', ReminderSchema);\n\nexport default Reminder; "],
  "mappings": "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",
  "names": ["mongoose", "import_mongoose", "mongoose"]
}
