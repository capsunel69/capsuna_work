{
  "version": 3,
  "sources": ["../../../../../../Users/alexcapsunel/Documents/GitHub/capsuna_work/netlify/functions/tasks.js", "../../../../../../Users/alexcapsunel/Documents/GitHub/capsuna_work/netlify/functions/utils/db.js", "../../../../../../Users/alexcapsunel/Documents/GitHub/capsuna_work/netlify/functions/models/Task.js"],
  "sourceRoot": "/var/folders/d6/2tbmdwln2p15fyp3qmqj0dt80000gn/T/tmp-18744-5Z6sKRgwWVop",
  "sourcesContent": ["import connectToDatabase from './utils/db.js';\nimport Task from './models/Task.js';\n\nexport const handler = async (event, context) => {\n  // Make the database connection available for reuse\n  context.callbackWaitsForEmptyEventLoop = false;\n  \n  console.log(`Tasks API: ${event.httpMethod} ${event.path}`);\n  \n  try {\n    // Connect to database\n    const db = await connectToDatabase();\n    console.log('Database connection established');\n    \n    // Handle different HTTP methods\n    switch (event.httpMethod) {\n      case 'GET':\n        if (event.path === '/.netlify/functions/tasks') {\n          // Get all tasks\n          console.log('Getting all tasks');\n          const tasks = await Task.find();\n          console.log(`Found ${tasks.length} tasks`);\n          return {\n            statusCode: 200,\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(tasks)\n          };\n        } else {\n          // Get single task by ID (from path parameter)\n          const id = event.path.split('/').pop();\n          console.log(`Getting task with ID: ${id}`);\n          const task = await Task.findOne({ id });\n          \n          if (!task) {\n            console.log(`Task not found with ID: ${id}`);\n            return {\n              statusCode: 404,\n              body: JSON.stringify({ message: 'Task not found' })\n            };\n          }\n          \n          console.log('Task found:', task.title);\n          return {\n            statusCode: 200,\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify(task)\n          };\n        }\n      \n      case 'POST':\n        // Create a new task\n        const taskData = JSON.parse(event.body);\n        console.log('Creating new task:', JSON.stringify(taskData));\n        \n        const newTask = new Task(taskData);\n        console.log('Task model created, saving to database...');\n        \n        const savedTask = await newTask.save();\n        console.log('Task saved to database with ID:', savedTask.id);\n        \n        return {\n          statusCode: 201,\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(savedTask)\n        };\n      \n      case 'PUT':\n        // Update a task\n        const updateId = event.path.split('/').pop();\n        const updateData = JSON.parse(event.body);\n        console.log(`Updating task ${updateId}:`, JSON.stringify(updateData));\n        \n        const updatedTask = await Task.findOneAndUpdate(\n          { id: updateId },\n          updateData,\n          { new: true }\n        );\n        \n        if (!updatedTask) {\n          console.log(`Task not found for update with ID: ${updateId}`);\n          return {\n            statusCode: 404,\n            body: JSON.stringify({ message: 'Task not found' })\n          };\n        }\n        \n        console.log('Task updated:', updatedTask.title);\n        return {\n          statusCode: 200,\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(updatedTask)\n        };\n      \n      case 'DELETE':\n        // Delete a task\n        const deleteId = event.path.split('/').pop();\n        console.log(`Deleting task with ID: ${deleteId}`);\n        \n        const deletedTask = await Task.findOneAndDelete({ id: deleteId });\n        \n        if (!deletedTask) {\n          console.log(`Task not found for deletion with ID: ${deleteId}`);\n          return {\n            statusCode: 404,\n            body: JSON.stringify({ message: 'Task not found' })\n          };\n        }\n        \n        console.log('Task deleted successfully');\n        return {\n          statusCode: 200,\n          body: JSON.stringify({ message: 'Task deleted' })\n        };\n      \n      default:\n        // Method not allowed\n        console.log(`Method not allowed: ${event.httpMethod}`);\n        return {\n          statusCode: 405,\n          body: JSON.stringify({ message: 'Method not allowed' })\n        };\n    }\n  } catch (error) {\n    console.error('Error in tasks function:', error);\n    return {\n      statusCode: 500,\n      body: JSON.stringify({ \n        message: 'Server error', \n        error: error.message,\n        stack: error.stack \n      })\n    };\n  }\n}; ", "import mongoose from 'mongoose';\n\nlet cachedDb = null;\n\nasync function connectToDatabase() {\n  if (cachedDb) {\n    return cachedDb;\n  }\n\n  // Debug: Log all env vars starting with REACT_APP or MONGODB (without values for security)\n  console.log('Available env vars:', Object.keys(process.env).filter(k => \n    k.includes('MONGO') || k.includes('REACT_APP')\n  ));\n  \n  // Get MongoDB URI from environment\n  const mongoUri = process.env.REACT_APP_MONGODB_URI;\n  \n  // Debug logging\n  console.log('REACT_APP_MONGODB_URI exists:', !!mongoUri);\n  console.log('REACT_APP_MONGODB_URI type:', typeof mongoUri);\n  console.log('REACT_APP_MONGODB_URI length:', mongoUri ? mongoUri.length : 0);\n  \n  // Validate URI exists and is a non-empty string\n  if (!mongoUri || typeof mongoUri !== 'string' || mongoUri.trim() === '') {\n    const error = new Error(\n      'REACT_APP_MONGODB_URI environment variable is not set or is empty. ' +\n      'Please configure it in your Netlify dashboard under Site settings > Environment variables. ' +\n      `Current value type: ${typeof mongoUri}, truthy: ${!!mongoUri}`\n    );\n    console.error(error.message);\n    throw error;\n  }\n\n  // Validate URI format\n  if (!mongoUri.startsWith('mongodb://') && !mongoUri.startsWith('mongodb+srv://')) {\n    const error = new Error(\n      `Invalid MongoDB URI format. URI must start with 'mongodb://' or 'mongodb+srv://'. ` +\n      `Got: ${mongoUri.substring(0, 20)}...`\n    );\n    console.error(error.message);\n    throw error;\n  }\n\n  // Connection options\n  const options = {\n    dbName: 'capsuna_work' // Explicitly set the database name\n  };\n\n  try {\n    console.log('Connecting to MongoDB...');\n    console.log('MongoDB URI (masked):', mongoUri.replace(/\\/\\/([^:]+):([^@]+)@/, '//$1:****@'));\n    \n    const conn = await mongoose.connect(mongoUri, options);\n    cachedDb = conn;\n    console.log('MongoDB connected successfully to database:', conn.connection.db.databaseName);\n    return cachedDb;\n  } catch (error) {\n    console.error('MongoDB connection error:', error.message);\n    throw error;\n  }\n}\n\nexport default connectToDatabase; ", "import mongoose from 'mongoose';\n\nconst TimerSessionSchema = new mongoose.Schema({\n  id: {\n    type: String,\n    required: true\n  },\n  startTime: {\n    type: Date,\n    required: true\n  },\n  endTime: {\n    type: Date\n  },\n  duration: {\n    type: Number,\n    required: true,\n    default: 0\n  }\n});\n\nconst TaskSchema = new mongoose.Schema({\n  id: {\n    type: String,\n    required: true,\n    unique: true\n  },\n  title: {\n    type: String,\n    required: true\n  },\n  description: {\n    type: String,\n    default: ''\n  },\n  completed: {\n    type: Boolean,\n    default: false\n  },\n  completedAt: {\n    type: Date,\n    default: null\n  },\n  createdAt: {\n    type: Date,\n    default: Date.now\n  },\n  priority: {\n    type: String,\n    enum: ['low', 'medium', 'high'],\n    default: 'medium'\n  },\n  dueDate: {\n    type: Date\n  },\n  timeSpent: {\n    type: Number,\n    default: 0\n  },\n  timers: [TimerSessionSchema],\n  convertedFromReminder: {\n    type: String,\n    default: null\n  }\n}, {\n  collection: 'tasks',\n  timestamps: true\n});\n\n// Use existing model if it exists, otherwise create a new one\nconst Task = mongoose.models.Task || mongoose.model('Task', TaskSchema);\n\nexport default Task; "],
  "mappings": "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",
  "names": ["mongoose", "import_mongoose", "mongoose"]
}
